db:
  image: healthcheck/percona
  cached: true
  volumes:
    - ./dev/fresh-magento-sampledata.sql:/docker-entrypoint-initdb.d/magento.sql

  encrypted_env_file: codeship.env.encrypted
web:
  image: eu.gcr.io/ems-plugins/magento:2.2.3
  depends_on:
    - db
  volumes:
    - ./dev/Magento/composer.json:/var/www/html/composer.json
    - ./dev/setup:/etc/my_init.d/setup
    - .:/var/www/html/vendor/emartech/emarsys-magento2-extension
  cached: true
  encrypted_env_file: codeship.env.encrypted
  dockercfg_service: dockercfg_generator
dockercfg_generator:
  image: codeship/gcr-dockercfg-generator
  add_docker: true
  encrypted_env_file: codeship.env.encrypted
node:
  image: "node:9.11.1-alpine"
  depends_on:
    - db
    - web
  working_dir: /test
  volumes:
    - ./dev/test:/test
  expose:
    - "8081"
  encrypted_env_file: codeship.env.encrypted
deploy:
  build:
    image: emarsys/magento-extension-deploy
    dockerfile: ./dev/Deploy/Dockerfile
  encrypted_env_file: codeship.env.encrypted
  volumes:
    - ./.ssh:/root/.ssh