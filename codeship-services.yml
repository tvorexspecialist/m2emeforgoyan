db:
  image: healthcheck/percona
  cached: true
  encrypted_env_file: codeship.env.encrypted
web:
  image: eu.gcr.io/ems-plugins/magento-sampledata:2.2.3
  depends_on:
    - db
  volumes:
    - ./dev/Magento/composer.json:/app/composer.json
    - ./dev/setup:/opt/emartech/setup
    - .:/app/vendor/emartech/emarsys-magento2-extension
  cached: false
  encrypted_env_file: codeship.env.encrypted
  dockercfg_service: dockercfg_generator
dockercfg_generator:
  image: codeship/gcr-dockercfg-generator
  add_docker: true
  encrypted_env_file: codeship.env.encrypted
node:
  image: "node:9.11.1-alpine"
  links:
    - web:magento.local
  depends_on:
    - db
    - web
  working_dir: /test
  volumes:
    - ./dev/test:/test
  expose:
    - "8081"
  encrypted_env_file: codeship.env.encrypted
deployment:
  image: codeship/google-cloud-deployment
  encrypted_env_file: codeship.env.encrypted
  add_docker: true
  volumes:
    - ./dev/Deploy/restart.sh:/deploy/restart.sh